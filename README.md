# Class163_NexT API 文档

## 版本信息

- **当前版本**: `v0.2.0`
- **更新日期**: 2026-02-26

## 基础信息

- **基础URL**: `http://127.0.0.1:16360`
- **API前缀**: `/api`
- **文档地址**: `http://127.0.0.1:16360/docs` (Swagger UI)
- **备用文档**: `http://127.0.0.1:16360/redoc` (ReDoc)

---

## 通用说明

### 认证
所有API接口都需要有效的登录会话。如果未登录，将返回 `401` 错误：
```json
{
  "detail": "未找到有效会话，请先登录"
}
```

### 通用错误码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 301/302/307 | 重定向（用于文件和封面下载） |
| 401 | 未认证，需要登录 |
| 404 | 资源未找到 |
| 500 | 服务器内部错误 |

---

## 接口列表

### 1. 基础接口

#### 1.1 健康检查
```
GET /health
```

**响应示例**:
```json
{
  "status": "healthy"
}
```

---

### 2. 音乐接口

#### 2.1 获取音乐信息
```
GET /api/music/info
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 音乐ID |
| detail | bool | 否 | 是否获取详细信息，默认 `true` |

**响应示例**:
```json
{
  "id": 3342707944,
  "title": "系在蝴蝶上的红线 中文填词 feat. 夢ノ結唱 POPY",
  "artists": ["遠山霞", "CooooldWind"],
  "album": "系在蝴蝶上的红线 中文填词 feat. 夢ノ結唱 POPY",
  "cover_url": "https://p1.music.126.net/xxx.jpg"
}
```

---

#### 2.2 获取音乐文件（重定向）
```
GET /api/music/file
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 音乐ID |
| quality | int | 否 | 音质等级，默认 `1` |

**音质等级说明**:

| 等级 | 说明 |
|------|------|
| 1 | 标准 (128kbps MP3) |
| 2 | 较高 (192kbps MP3) |
| 3 | 极高 (320kbps MP3) |
| 4 | 无损 (FLAC) |
| 5 | 高解析度无损 (Hi-Res) |

**响应**: 返回 `307` 重定向到音乐文件下载链接

---

#### 2.3 获取音乐歌词
```
GET /api/music/lyric
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 音乐ID |

**响应示例**:
```json
{
  "id": 3342707944,
  "title": "系在蝴蝶上的红线 中文填词 feat. 夢ノ結唱 POPY",
  "artists": ["遠山霞", "CooooldWind"],
  "lyric": "[00:00.672]几年前送给我的那捧花..."
}
```

---

#### 2.4 获取音乐封面（重定向）
```
GET /api/music/cover
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 音乐ID |
| pixel | int | 否 | 图片边长（像素），若不填则由网站决定 |

**响应**: 返回 `307` 重定向到封面图片链接

---

### 3. 播放列表接口

#### 3.1 获取播放列表信息
```
GET /api/playlist/info
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 播放列表ID |
| info | bool | 否 | 是否获取基本信息，默认 `true` |
| detail | bool | 否 | 是否获取歌曲详情，默认 `false` |

**响应示例** (detail=false):
```json
{
  "id": 2391850012,
  "title": "Cooooldwind_喜欢的音乐",
  "creator": "Cooooldwind",
  "description": "",
  "track_count": 2253,
  "create_time": "2017-08-15 14:30:25",
  "update_time": "2025-02-25 10:15:30"
}
```

**响应示例** (detail=true):
```json
{
  "id": 2391850012,
  "title": "Cooooldwind_喜欢的音乐",
  "creator": "Cooooldwind",
  "description": "",
  "track_count": 2253,
  "create_time": "2017-08-15 14:30:25",
  "update_time": "2025-02-25 10:15:30",
  "songs": [
    {
      "id": 5239040,
      "title": "味道",
      "artists": ["辛晓琪"],
      "album": "滚石30周年精选珍藏集"
    }
  ]
}
```

---

#### 3.2 获取播放列表歌曲
```
GET /api/playlist/songs
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 播放列表ID |
| limit | int | 否 | 返回数量限制 |
| offset | int | 否 | 偏移量，默认 `0` |

**响应示例**:
```json
{
  "id": 2391850012,
  "title": "Cooooldwind_喜欢的音乐",
  "total_songs": 2253,
  "offset": 0,
  "limit": 5,
  "songs": [
    {
      "id": 5239040,
      "title": "味道",
      "artists": ["辛晓琪"],
      "album": "滚石30周年精选珍藏集"
    }
  ]
}
```

---

#### 3.3 获取播放列表封面（重定向）
```
GET /api/playlist/cover
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 播放列表ID |

**响应**: 返回 `307` 重定向到封面图片链接

---

### 4. 搜索接口

#### 4.1 综合搜索
```
GET /api/search/
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| keyword | str | 是 | 搜索关键词 |
| type | str | 否 | 搜索类型：`music`/`playlist`/`all`，默认 `all` |
| limit | int | 否 | 返回数量，默认 `10` |

**响应示例**:
```json
{
  "music_results": [
    {
      "id": 2142857204,
      "title": "雑踏、僕らの街",
      "artists": ["トゲナシトゲアリ"],
      "album": "雑踏、僕らの街"
    }
  ],
  "playlist_results": [
    {
      "id": 9855521527,
      "title": "トゲナシトゲアリ【闺泣】音乐全收录",
      "creator": "悦子DRG_Cer",
      "track_count": 113
    }
  ]
}
```

---

#### 4.2 搜索音乐
```
GET /api/search/music
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| keyword | str | 是 | 搜索关键词 |
| limit | int | 否 | 返回数量，默认 `10` |

**响应示例**:
```json
{
  "keyword": "トゲナシトゲアリ",
  "music_results": [
    {
      "id": 2142857204,
      "title": "雑踏、僕らの街",
      "artists": ["トゲナシトゲアリ"],
      "album": "雑踏、僕らの街"
    }
  ],
  "total": 193
}
```

---

#### 4.3 搜索播放列表
```
GET /api/search/playlist
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| keyword | str | 是 | 搜索关键词 |
| limit | int | 否 | 返回数量，默认 `10` |

**响应示例**:
```json
{
  "keyword": "トゲナシトゲアリ",
  "playlist_results": [
    {
      "id": 9855521527,
      "title": "トゲナシトゲアリ【闺泣】音乐全收录",
      "creator": "悦子DRG_Cer",
      "track_count": 113
    }
  ],
  "total": 93
}
```

---

### 5. 洛雪API服务接口

#### 5.1 获取音乐文件URL（JSON格式）
```
GET /api/lx_service/get
```

**参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | int | 是 | 音乐ID |
| qualify | int | 否 | 音质等级，默认 `1` |

**音质等级说明**:

| 等级 | 说明 |
|------|------|
| 1 | 标准 (128kbps MP3) |
| 2 | 较高 (192kbps MP3) |
| 3 | 极高 (320kbps MP3) |
| 4 | 无损 (FLAC) |
| 5 | 高解析度无损 (Hi-Res) |

**响应示例**:
```json
{
  "url": "https://music.126.net/xxx.mp3"
}
```

**说明**: 此接口返回JSON格式的URL，而非重定向响应，适合需要直接获取URL的场景。

---

## 数据模型

### Music (音乐)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 音乐ID |
| title | str | 歌曲标题 |
| artists | list[str] | 艺术家列表 |
| album | str | 专辑名称 |
| cover_url | str | 封面图片URL |
| lyric | str | 歌词内容（LRC格式） |

### Playlist (播放列表)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 播放列表ID |
| title | str | 列表标题 |
| creator | str | 创建者昵称 |
| description | str | 列表描述 |
| track_count | int | 歌曲总数 |
| create_time | str | 创建时间，格式 `YYYY-MM-DD HH:MM:SS` |
| update_time | str | 更新时间，格式 `YYYY-MM-DD HH:MM:SS` |
| songs | list[Music] | 歌曲列表（detail=true时返回） |

---

## 测试数据

为了方便测试，可以使用以下测试数据：

| 类型 | ID/关键词 | 说明 |
|------|-----------|------|
| 音乐ID | `3342707944` | （这是什么？点一下） |
| 歌单ID | `2391850012` | Cooooldwind_喜欢的音乐 |
| 搜索关键词 | `トゲナシトゲアリ` | 日本乐队 |

---

## 测试文件

项目包含一个测试文件 `api/test_api.py`，使用Python标准库测试所有API：

```bash
python api/test_api.py
```

测试内容包括：
- 健康检查
- 音乐信息、文件、歌词、封面
- 播放列表信息、歌曲、封面
- 搜索功能

---

## 注意事项

1. **会话管理**: API需要有效的网易云音乐登录会话，通过 `start.py` 启动时会自动完成登录
2. **重定向接口**: `/file` 和 `/cover` 接口返回重定向响应，客户端需要支持自动跟随重定向
3. **时间格式**: 所有时间字段统一使用 `YYYY-MM-DD HH:MM:SS` 格式
4. **分页**: 播放列表歌曲接口支持 `limit` 和 `offset` 分页参数
